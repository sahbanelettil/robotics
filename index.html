<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Kitchen Assistant</title>
  <link rel="manifest" href="/robotics/manifest.webmanifest">
  <meta name="theme-color" content="#0f172a" />
  <link rel="icon" sizes="192x192" href="/robotics/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/robotics/icons/icon-192.png">
  <style>
    :root { --bg:#0f172a; --card:#131c35; --fg:#e2e8f0; --accent:#22d3ee; }
    html,body{height:100%} body{margin:0;background:linear-gradient(135deg,#0f172a,#1e293b);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;display:flex;align-items:center;justify-content:center}
    .card{width:min(720px,92vw);background:rgba(19,28,53,.85);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    h1{margin:0 0 4px} .sub{opacity:.8;margin:0 0 16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    button{cursor:pointer;border:1px solid rgba(255,255,255,.15);background:#0b1224;color:var(--fg);padding:12px 14px;border-radius:12px}
    button.primary{background:linear-gradient(135deg,#22d3ee,#6366f1);border:none;color:#08111f;font-weight:700}
    .ok{color:#22d3ee} .muted{opacity:.75}
    /* Lock screen */
    #lock{position:fixed;inset:0;background:radial-gradient(1200px 800px at 50% 20%,rgba(34,211,238,.15),transparent),#0b1224;display:flex;align-items:center;justify-content:center;z-index:30}
    .lock-card{width:min(420px,92vw);background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:22px;box-shadow:0 16px 48px rgba(0,0,0,.4)}
    input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0b1224;color:var(--fg)}
    .err{color:#fca5a5;height:18px;margin-top:8px}
    .hidden{display:none}
    /* Install hint */
    #installBar{display:none;gap:10px;align-items:center;justify-content:space-between;margin:14px 0;padding:10px;border-radius:12px;background:#0b1224;border:1px solid rgba(255,255,255,.12)}
  </style>
</head>
<body>
  <div id="lock">
    <div class="lock-card">
      <h2>Enter Password</h2>
      <p class="muted">This app is protected. Please enter the access code to continue.</p>
      <input id="pw" type="password" placeholder="Password" autocomplete="current-password" />
      <div class="err" id="err"></div>
      <div class="row" style="margin-top:10px">
        <button class="primary" id="unlockBtn">Unlock</button>
      </div>
      <p class="muted" style="margin-top:8px">Hint: smart123</p>
    </div>
  </div>

  <div class="card">
    <h1>Smart Kitchen Assistant</h1>
    <p class="sub">Milk overflow + cooker whistle monitor with app control</p>

    <div id="installBar">
      <span>Install this app for offline and fullscreen use.</span>
      <div class="row">
        <button id="installBtn" class="primary">Install</button>
        <button id="dismissBtn">Dismiss</button>
      </div>
    </div>

    <div class="muted" id="status">Status: Checking install support…</div>
    <div style="margin-top:14px">
      <p class="muted">PWA ready on GitHub Pages. Use the Install button above or your browser menu to add to home screen.</p>
      <ul>
        <li>Works offline after first load (app shell cached)</li>
        <li>Auto‑hides the install prompt when already installed</li>
        <li>Password‑gated client side (non‑critical protection)</li>
      </ul>
    </div>
  </div>

  <script>
    // --- Password gate (client-side) ---
    const PASS = "smart123";
    const lock = document.getElementById("lock");
    const unlockBtn = document.getElementById("unlockBtn");
    const err = document.getElementById("err");
    unlockBtn.addEventListener("click", () => {
      const v = document.getElementById("pw").value.trim();
      if (v === PASS) {
        sessionStorage.setItem("access_ok", "1");
        lock.classList.add("hidden");
      } else {
        err.textContent = "Wrong password.";
      }
    });
    // Auto unlock for this tab if already entered
    if (sessionStorage.getItem("access_ok") === "1") lock.classList.add("hidden");

    // --- Service worker registration with scoped path /robotics/ ---
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/robotics/sw.js", { scope: "/robotics/" })
        .then(reg => console.log("SW registered:", reg.scope))
        .catch(err => console.error("SW registration failed:", err));
    }

    // --- PWA install prompt handling ---
    let deferredPrompt = null;
    const installBar = document.getElementById("installBar");
    const installBtn = document.getElementById("installBtn");
    const dismissBtn = document.getElementById("dismissBtn");
    const statusEl = document.getElementById("status");

    function isStandalone() {
      return window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true;
    }

    function updateInstallUI() {
      if (isStandalone()) {
        installBar.style.display = "none";
        statusEl.textContent = "Status: Installed (standalone mode)";
      } else if (deferredPrompt) {
        installBar.style.display = "flex";
        statusEl.textContent = "Status: Install available";
      } else {
        installBar.style.display = "none";
        statusEl.textContent = "Status: Install not available yet";
      }
    }

    window.addEventListener("beforeinstallprompt", (e) => {
      // Best practice: prevent auto prompt and show your own UI later
      e.preventDefault();
      deferredPrompt = e;
      console.log("beforeinstallprompt captured");
      updateInstallUI();
    });

    installBtn.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const choice = await deferredPrompt.userChoice;
      console.log("User choice:", choice.outcome);
      deferredPrompt = null;
      updateInstallUI();
    });

    dismissBtn.addEventListener("click", () => {
      deferredPrompt = null;
      updateInstallUI();
    });

    window.addEventListener("appinstalled", () => {
      console.log("PWA installed");
      deferredPrompt = null;
      updateInstallUI();
    });

    // Initial UI status
    updateInstallUI();
  </script>
</body>
</html>
