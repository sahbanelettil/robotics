<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Smart Kitchen • PWA</title>
  <link rel="manifest" href="/robotics/manifest.webmanifest" />
  <meta name="theme-color" content="#1c2541" />
  <link rel="icon" href="/robotics/icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="/robotics/icons/icon-192.png" />
  <style>
    :root { --bg: #0f172a; --card:#111827; --fg:#e5e7eb; --accent:#3b82f6; --danger:#ef4444; }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(135deg,#0f172a,#111827);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;min-height:100svh}
    header{padding:14px 18px;display:flex;justify-content:space-between;align-items:center;background:#0b1220;border-bottom:1px solid #1f2937;position:sticky;top:0}
    .btn{cursor:pointer;border:0;border-radius:12px;padding:10px 14px;font-weight:700;color:#fff;background:var(--accent);display:none}
    .btn.show{display:inline-block}
    main{max-width:900px;margin:22px auto;padding:0 16px}
    .card{background:#0b1220;border:1px solid #1f2937;border-radius:16px;padding:18px;box-shadow:0 8px 28px rgba(0,0,0,.35)}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:8px 0}
    /* Password gate */
    #gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(10,12,22,.92);backdrop-filter:blur(6px);z-index:30}
    #gate .panel{width:min(92svw,420px);background:#0b1220;border:1px solid #1f2937;border-radius:18px;padding:22px}
    #gate h2{margin:0 0 10px}
    .row{display:flex;gap:10px;margin-top:10px}
    input[type=password]{flex:1;background:#0f172a;border:1px solid #233045;border-radius:12px;padding:12px;color:var(--fg);outline:none}
    button.primary{background:var(--accent);color:#fff;border:0;border-radius:12px;padding:12px 14px;font-weight:800;cursor:pointer}
    .err{color:var(--danger);font-weight:700;min-height:20px;margin-top:8px}
    .hint{opacity:.75;font-size:.9rem}
  </style>
</head>
<body>
  <header>
    <div>Smart Kitchen • PWA</div>
    <button id="installBtn" class="btn">Install app</button>
  </header>

  <!-- Password gate -->
  <section id="gate" aria-modal="true" role="dialog">
    <div class="panel">
      <h2>Enter password</h2>
      <p class="hint">Protected demo • Enter the access code to continue</p>
      <div class="row">
        <input id="pwd" type="password" placeholder="Password" autocomplete="current-password" />
        <button id="go" class="primary">Unlock</button>
      </div>
      <div id="err" class="err"></div>
    </div>
  </section>

  <main id="app" hidden>
    <div class="card">
      <h1>Smart Kitchen App</h1>
      <p>This is the installed‑ready web app shell without a service worker. Use the Install button above when available, or add to Home Screen on iOS. Add your UI here. </p>
      <p>Repo path: /robotics/ • Icons loaded from /robotics/icons/. </p>
    </div>
  </main>

  <script>
    // ---- Password gate (client-side only; not strong security) ----
    const PASS = "smart123";
    const gate = document.getElementById('gate');
    const app = document.getElementById('app');
    const err = document.getElementById('err');
    const pwd = document.getElementById('pwd');
    const go = document.getElementById('go');

    function unlockIfAuth() {
      if (sessionStorage.getItem('auth') === 'ok') {
        gate.style.display = 'none';
        app.hidden = false;
      }
    }
    function tryUnlock() {
      if ((pwd.value || '').trim() === PASS) {
        sessionStorage.setItem('auth','ok');
        err.textContent = '';
        unlockIfAuth();
      } else {
        err.textContent = 'Wrong password';
      }
    }
    go.addEventListener('click', tryUnlock);
    pwd.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') tryUnlock(); });
    unlockIfAuth();

    // ---- PWA install flow without service worker ----
    // Note: Installability depends on browser criteria; SW is not strictly required in modern Chromium menus, but criteria may still vary by platform.
    // See MDN + Chrome updates for details.
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');

    // Show button if app not installed and event is fired
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      // Only show if not already installed
      const standalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
      if (!standalone) installBtn.classList.add('show');
    });

    // Hide install button when installed
    window.addEventListener('appinstalled', () => {
      deferredPrompt = null;
      installBtn.classList.remove('show');
    });

    // Also hide if already in standalone
    if (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) {
      installBtn.classList.remove('show');
    }

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) {
        // Fallback for platforms without beforeinstallprompt: suggest “Add to Home Screen” from browser menu
        alert('Install not available here. Use your browser menu: Add to Home Screen / Install app.');
        return;
      }
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      // outcome: 'accepted' or 'dismissed'
      deferredPrompt = null;
      if (outcome === 'accepted') installBtn.classList.remove('show');
    });
  </script>
</body>
</html>
